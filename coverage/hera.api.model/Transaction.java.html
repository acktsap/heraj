<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Transaction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">heraj</a> &gt; <a href="index.source.html" class="el_package">hera.api.model</a> &gt; <span class="el_source">Transaction.java</span></div><h1>Transaction.java</h1><pre class="source lang-java linenums">/*
 * @copyright defined in LICENSE.txt
 */

package hera.api.model;

import hera.annotation.ApiAudience;
import hera.annotation.ApiStability;
import hera.util.TransactionUtils;
import lombok.EqualsAndHashCode;
import lombok.Getter;
import lombok.RequiredArgsConstructor;
import lombok.ToString;

@ApiAudience.Public
@ApiStability.Unstable
<span class="nc" id="L17">@ToString(callSuper = true)</span>
<span class="pc bpc" id="L18" title="26 of 38 branches missed.">@EqualsAndHashCode(callSuper = true)</span>
public class Transaction extends RawTransaction {

  @ApiAudience.Public
  public static TransactionWithoutSign newBuilder(final RawTransaction rawTransaction) {
<span class="fc" id="L23">    return new Transaction.Builder(rawTransaction);</span>
  }

<span class="fc" id="L26">  @Getter</span>
  protected final Signature signature;

<span class="fc" id="L29">  @Getter</span>
  protected final TxHash hash;

<span class="fc" id="L32">  @Getter</span>
  protected final BlockHash blockHash;

<span class="fc" id="L35">  @Getter</span>
  protected final int indexInBlock;

<span class="fc" id="L38">  @Getter</span>
  protected final boolean confirmed;

<span class="fc" id="L41">  @RequiredArgsConstructor</span>
  public enum TxType {
<span class="fc" id="L43">    UNRECOGNIZED(-1), NORMAL(0), GOVERNANCE(1);</span>

<span class="fc" id="L45">    @Getter</span>
    private final int intValue;
  }

  /**
   * Transaction constructor.
   *
   * @param rawTransaction a transaction without block information
   * @param signature a signature
   * @param txHash a txHash
   * @param blockHash a block hash
   * @param indexInBlock an indexInBlock
   * @param isConfirmed an confirm state
   */
  @ApiAudience.Private
  public Transaction(final RawTransaction rawTransaction, final Signature signature,
      final TxHash txHash, final BlockHash blockHash, final int indexInBlock,
      final boolean isConfirmed) {
<span class="fc" id="L63">    this(rawTransaction.getSender(), rawTransaction.getRecipient(), rawTransaction.getAmount(),</span>
<span class="fc" id="L64">        rawTransaction.getNonce(), rawTransaction.getFee(),</span>
<span class="fc" id="L65">        rawTransaction.getPayload(), rawTransaction.getTxType(),</span>
        signature, txHash, blockHash, indexInBlock, isConfirmed);
<span class="fc" id="L67">  }</span>

  /**
   * Transaction constructor.
   *
   * @param sender a sender
   * @param recipient a recipient
   * @param amount an amount
   * @param nonce an nonce
   * @param fee a fee
   * @param payload a payload
   * @param txType a txType
   * @param signature a signature
   * @param txHash a txHash
   * @param blockHash a block hash
   * @param indexInBlock an indexInBlock
   * @param isConfirmed an confirm state
   */
  @ApiAudience.Private
  public Transaction(final AccountAddress sender, final AccountAddress recipient,
      final Aer amount, long nonce, final Fee fee, final BytesValue payload,
      final TxType txType, final Signature signature, final TxHash txHash,
      final BlockHash blockHash, final int indexInBlock, final boolean isConfirmed) {
<span class="fc" id="L90">    super(sender, recipient, amount, nonce, fee, payload, txType);</span>
<span class="fc bfc" id="L91" title="All 2 branches covered.">    this.signature = null != signature ? signature : Signature.of(BytesValue.EMPTY);</span>
<span class="fc bfc" id="L92" title="All 2 branches covered.">    this.hash = null != txHash ? txHash : TxHash.of(BytesValue.EMPTY);</span>
<span class="fc bfc" id="L93" title="All 2 branches covered.">    this.blockHash = null != blockHash ? blockHash : BlockHash.of(BytesValue.EMPTY);</span>
<span class="fc" id="L94">    this.indexInBlock = indexInBlock;</span>
<span class="fc" id="L95">    this.confirmed = isConfirmed;</span>
<span class="fc" id="L96">  }</span>

  public interface TransactionWithoutSign {
    TransactionWithSign signature(Signature signature);
  }

  public interface TransactionWithSign extends hera.util.Builder&lt;Transaction&gt; {
  }

<span class="fc" id="L105">  @RequiredArgsConstructor</span>
  protected static class Builder implements TransactionWithoutSign, TransactionWithSign {

    private final RawTransaction rawTransaction;

    private Signature signature;

    @Override
    public TransactionWithSign signature(final Signature signature) {
<span class="fc" id="L114">      this.signature = signature;</span>
<span class="fc" id="L115">      return this;</span>
    }

    @Override
    public Transaction build() {
<span class="fc" id="L120">      return new Transaction(rawTransaction, signature,</span>
<span class="fc" id="L121">          TransactionUtils.calculateHash(rawTransaction, signature), null, 0, false);</span>
    }
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>